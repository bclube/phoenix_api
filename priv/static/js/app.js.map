{"version":3,"sources":["web/static/js/app.js","web/static/js/phoenix.js","web/static/js/phoenix_html.js","web/static/js/player.js","web/static/js/socket.js","web/static/js/video.js"],"names":["Video","init","socket","document","getElementById","exports","_typeof","Symbol","iterator","obj","constructor","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","Constructor","protoProps","staticProps","prototype","value","_toConsumableArray","arr","Array","isArray","arr2","from","_classCallCheck","instance","TypeError","VSN","SOCKET_STATES","connecting","open","closing","closed","DEFAULT_TIMEOUT","CHANNEL_STATES","errored","joined","joining","leaving","CHANNEL_EVENTS","close","error","join","reply","leave","TRANSPORTS","longpoll","websocket","Push","channel","event","payload","timeout","receivedResp","timeoutTimer","recHooks","sent","resend","cancelRefEvent","ref","refEvent","send","hasReceived","startTimeout","push","topic","receive","status","callback","response","matchReceive","_ref","filter","h","forEach","off","cancelTimeout","clearTimeout","_this","makeRef","replyEventName","on","setTimeout","trigger","Channel","params","_this2","state","bindings","joinedOnce","joinPush","pushBuffer","rejoinTimer","Timer","rejoinUntilConnected","reconnectAfterMs","reset","pushEvent","onClose","log","joinRef","remove","onError","reason","isLeaving","isClosed","scheduleTimeout","isJoining","isConnected","rejoin","arguments","undefined","bind","canPush","isJoined","_this3","leavePush","onMessage","isMember","sendJoin","indexOf","handledPayload","map","isErrored","Socket","endPoint","_this4","opts","stateChangeCallbacks","message","channels","sendBuffer","transport","window","WebSocket","LongPoll","heartbeatIntervalMs","tries","logger","longpollerTimeout","reconnectTimer","disconnect","connect","protocol","location","match","endPointURL","uri","Ajax","appendParams","vsn","charAt","host","code","conn","onclose","_this5","console","onopen","onConnOpen","onerror","onConnError","onmessage","onConnMessage","onConnClose","kind","msg","data","onOpen","_this6","flushSendBuffer","skipHeartbeat","clearInterval","heartbeatTimer","setInterval","sendHeartbeat","triggerChanError","connectionState","readyState","c","chanParams","chan","_this7","JSON","stringify","newRef","toString","rawMessage","parse","token","pollEndpoint","normalizeEndpoint","poll","replace","RegExp","endpointURL","closeAndRetry","ontimeout","_this8","request","resp","messages","body","_this9","method","accept","XDomainRequest","req","xdomainRequest","XMLHttpRequest","ActiveXObject","xhrRequest","_this10","onload","parseJSON","responseText","onprogress","_this11","setRequestHeader","onreadystatechange","states","complete","serialize","parentKey","queryStr","hasOwnProperty","paramKey","paramVal","encodeURIComponent","url","keys","prefix","Presence","syncState","currentState","newState","onJoin","onLeave","_this12","clone","joins","leaves","presence","newPresence","currentPresence","newRefs","metas","m","phx_ref","curRefs","joinedMetas","leftMetas","syncDiff","_ref2","_state$key$metas","unshift","apply","leftPresence","refsToRemove","p","list","presences","chooser","pres","func","getOwnPropertyNames","timerCalc","timer","_this13","Phoenix","buildHiddenInput","name","input","createElement","type","handleLinkClick","link","getAttribute","confirm","to","csrf","form","action","style","display","appendChild","submit","addEventListener","e","element","preventDefault","parentNode","Player","player","domId","playerId","onReady","onYouTubeIframeAPIReady","onIframeReady","youtubeScriptTag","src","head","YT","height","width","videoId","events","onPlayerStateChange","getCurrentTime","Math","floor","seekTo","millsec","userToken","id","msgContainer","msgInput","postButton","vidChannel","at","seconds","last_seen_id","renderAnnotation","ids","annotations","ann","max","scheduleMessages","esc","str","div","createTextNode","innerHTML","user","template","formatTime","username","scrollTop","scrollHeight","ctime","remaining","renderAtTime","date","Date","setSeconds","toISOString","substr"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;;;AAEAA,gBAAMC,IAAN,CAAWC,gBAAX,EAAmBC,SAASC,cAAT,CAAwB,OAAxB,CAAnB;;;;;;;;ACHA,CAAC,UAASC,OAAT,EAAiB;AAClB;;AAEA,MAAIC,UAAU,OAAOC,MAAP,KAAkB,UAAlB,IAAgC,SAAOA,OAAOC,QAAd,MAA2B,QAA3D,GAAsE,UAAUC,GAAV,EAAe;AAAE,kBAAcA,GAAd,0CAAcA,GAAd;AAAoB,GAA3G,GAA8G,UAAUA,GAAV,EAAe;AAAE,WAAOA,OAAO,OAAOF,MAAP,KAAkB,UAAzB,IAAuCE,IAAIC,WAAJ,KAAoBH,MAA3D,GAAoE,QAApE,UAAsFE,GAAtF,0CAAsFA,GAAtF,CAAP;AAAmG,GAAhP;;AAEA,MAAIE,eAAe,YAAY;AAAE,aAASC,gBAAT,CAA0BC,MAA1B,EAAkCC,KAAlC,EAAyC;AAAE,WAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAID,MAAME,MAA1B,EAAkCD,GAAlC,EAAuC;AAAE,YAAIE,aAAaH,MAAMC,CAAN,CAAjB,CAA2BE,WAAWC,UAAX,GAAwBD,WAAWC,UAAX,IAAyB,KAAjD,CAAwDD,WAAWE,YAAX,GAA0B,IAA1B,CAAgC,IAAI,WAAWF,UAAf,EAA2BA,WAAWG,QAAX,GAAsB,IAAtB,CAA4BC,OAAOC,cAAP,CAAsBT,MAAtB,EAA8BI,WAAWM,GAAzC,EAA8CN,UAA9C;AAA4D;AAAE,KAAC,OAAO,UAAUO,WAAV,EAAuBC,UAAvB,EAAmCC,WAAnC,EAAgD;AAAE,UAAID,UAAJ,EAAgBb,iBAAiBY,YAAYG,SAA7B,EAAwCF,UAAxC,EAAqD,IAAIC,WAAJ,EAAiBd,iBAAiBY,WAAjB,EAA8BE,WAA9B,EAA4C,OAAOF,WAAP;AAAqB,KAAhN;AAAmN,GAA9hB,EAAnB;;AAEAH,SAAOC,cAAP,CAAsBjB,OAAtB,EAA+B,YAA/B,EAA6C;AAC3CuB,WAAO;AADoC,GAA7C;;AAIA,WAASC,kBAAT,CAA4BC,GAA5B,EAAiC;AAAE,QAAIC,MAAMC,OAAN,CAAcF,GAAd,CAAJ,EAAwB;AAAE,WAAK,IAAIf,IAAI,CAAR,EAAWkB,OAAOF,MAAMD,IAAId,MAAV,CAAvB,EAA0CD,IAAIe,IAAId,MAAlD,EAA0DD,GAA1D,EAA+D;AAAEkB,aAAKlB,CAAL,IAAUe,IAAIf,CAAJ,CAAV;AAAmB,OAAC,OAAOkB,IAAP;AAAc,KAA7H,MAAmI;AAAE,aAAOF,MAAMG,IAAN,CAAWJ,GAAX,CAAP;AAAyB;AAAE;;AAEnM,WAASK,eAAT,CAAyBC,QAAzB,EAAmCZ,WAAnC,EAAgD;AAAE,QAAI,EAAEY,oBAAoBZ,WAAtB,CAAJ,EAAwC;AAAE,YAAM,IAAIa,SAAJ,CAAc,mCAAd,CAAN;AAA2D;AAAE;;AAEzJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAC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","file":"priv/static/js/app.js","sourcesContent":["import socket from \"./socket\"\r\nimport Video from \"./video\"\r\n\r\nVideo.init(socket, document.getElementById(\"video\"))","(function(exports){\r\n\"use strict\";\r\n\r\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\r\n\r\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\r\n\r\nObject.defineProperty(exports, \"__esModule\", {\r\n  value: true\r\n});\r\n\r\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\r\n\r\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\r\n\r\n// Phoenix Channels JavaScript client\r\n//\r\n// ## Socket Connection\r\n//\r\n// A single connection is established to the server and\r\n// channels are multiplexed over the connection.\r\n// Connect to the server using the `Socket` class:\r\n//\r\n//     let socket = new Socket(\"/ws\", {params: {userToken: \"123\"}})\r\n//     socket.connect()\r\n//\r\n// The `Socket` constructor takes the mount point of the socket,\r\n// the authentication params, as well as options that can be found in\r\n// the Socket docs, such as configuring the `LongPoll` transport, and\r\n// heartbeat.\r\n//\r\n// ## Channels\r\n//\r\n// Channels are isolated, concurrent processes on the server that\r\n// subscribe to topics and broker events between the client and server.\r\n// To join a channel, you must provide the topic, and channel params for\r\n// authorization. Here's an example chat room example where `\"new_msg\"`\r\n// events are listened for, messages are pushed to the server, and\r\n// the channel is joined with ok/error/timeout matches:\r\n//\r\n//     let channel = socket.channel(\"room:123\", {token: roomToken})\r\n//     channel.on(\"new_msg\", msg => console.log(\"Got message\", msg) )\r\n//     $input.onEnter( e => {\r\n//       channel.push(\"new_msg\", {body: e.target.val}, 10000)\r\n//        .receive(\"ok\", (msg) => console.log(\"created message\", msg) )\r\n//        .receive(\"error\", (reasons) => console.log(\"create failed\", reasons) )\r\n//        .receive(\"timeout\", () => console.log(\"Networking issue...\") )\r\n//     })\r\n//     channel.join()\r\n//       .receive(\"ok\", ({messages}) => console.log(\"catching up\", messages) )\r\n//       .receive(\"error\", ({reason}) => console.log(\"failed join\", reason) )\r\n//       .receive(\"timeout\", () => console.log(\"Networking issue. Still waiting...\") )\r\n//\r\n//\r\n// ## Joining\r\n//\r\n// Creating a channel with `socket.channel(topic, params)`, binds the params to\r\n// `channel.params`, which are sent up on `channel.join()`.\r\n// Subsequent rejoins will send up the modified params for\r\n// updating authorization params, or passing up last_message_id information.\r\n// Successful joins receive an \"ok\" status, while unsuccessful joins\r\n// receive \"error\".\r\n//\r\n// ## Duplicate Join Subscriptions\r\n//\r\n// While the client may join any number of topics on any number of channels,\r\n// the client may only hold a single subscription for each unique topic at any\r\n// given time. When attempting to create a duplicate subscription,\r\n// the server will close the existing channel, log a warning, and\r\n// spawn a new channel for the topic. The client will have their\r\n// `channel.onClose` callbacks fired for the existing channel, and the new\r\n// channel join will have its receive hooks processed as normal.\r\n//\r\n// ## Pushing Messages\r\n//\r\n// From the previous example, we can see that pushing messages to the server\r\n// can be done with `channel.push(eventName, payload)` and we can optionally\r\n// receive responses from the push. Additionally, we can use\r\n// `receive(\"timeout\", callback)` to abort waiting for our other `receive` hooks\r\n//  and take action after some period of waiting. The default timeout is 5000ms.\r\n//\r\n//\r\n// ## Socket Hooks\r\n//\r\n// Lifecycle events of the multiplexed connection can be hooked into via\r\n// `socket.onError()` and `socket.onClose()` events, ie:\r\n//\r\n//     socket.onError( () => console.log(\"there was an error with the connection!\") )\r\n//     socket.onClose( () => console.log(\"the connection dropped\") )\r\n//\r\n//\r\n// ## Channel Hooks\r\n//\r\n// For each joined channel, you can bind to `onError` and `onClose` events\r\n// to monitor the channel lifecycle, ie:\r\n//\r\n//     channel.onError( () => console.log(\"there was an error!\") )\r\n//     channel.onClose( () => console.log(\"the channel has gone away gracefully\") )\r\n//\r\n// ### onError hooks\r\n//\r\n// `onError` hooks are invoked if the socket connection drops, or the channel\r\n// crashes on the server. In either case, a channel rejoin is attempted\r\n// automatically in an exponential backoff manner.\r\n//\r\n// ### onClose hooks\r\n//\r\n// `onClose` hooks are invoked only in two cases. 1) the channel explicitly\r\n// closed on the server, or 2). The client explicitly closed, by calling\r\n// `channel.leave()`\r\n//\r\n//\r\n// ## Presence\r\n//\r\n// The `Presence` object provides features for syncing presence information\r\n// from the server with the client and handling presences joining and leaving.\r\n//\r\n// ### Syncing initial state from the server\r\n//\r\n// `Presence.syncState` is used to sync the list of presences on the server\r\n// with the client's state. An optional `onJoin` and `onLeave` callback can\r\n// be provided to react to changes in the client's local presences across\r\n// disconnects and reconnects with the server.\r\n//\r\n// `Presence.syncDiff` is used to sync a diff of presence join and leave\r\n// events from the server, as they happen. Like `syncState`, `syncDiff`\r\n// accepts optional `onJoin` and `onLeave` callbacks to react to a user\r\n// joining or leaving from a device.\r\n//\r\n// ### Listing Presences\r\n//\r\n// `Presence.list` is used to return a list of presence information\r\n// based on the local state of metadata. By default, all presence\r\n// metadata is returned, but a `listBy` function can be supplied to\r\n// allow the client to select which metadata to use for a given presence.\r\n// For example, you may have a user online from different devices with a\r\n// a metadata status of \"online\", but they have set themselves to \"away\"\r\n// on another device. In this case, they app may choose to use the \"away\"\r\n// status for what appears on the UI. The example below defines a `listBy`\r\n// function which prioritizes the first metadata which was registered for\r\n// each user. This could be the first tab they opened, or the first device\r\n// they came online from:\r\n//\r\n//     let state = {}\r\n//     state = Presence.syncState(state, stateFromServer)\r\n//     let listBy = (id, {metas: [first, ...rest]}) => {\r\n//       first.count = rest.length + 1 // count of this user's presences\r\n//       first.id = id\r\n//       return first\r\n//     }\r\n//     let onlineUsers = Presence.list(state, listBy)\r\n//\r\n//\r\n// ### Example Usage\r\n//\r\n//     // detect if user has joined for the 1st time or from another tab/device\r\n//     let onJoin = (id, current, newPres) => {\r\n//       if(!current){\r\n//         console.log(\"user has entered for the first time\", newPres)\r\n//       } else {\r\n//         console.log(\"user additional presence\", newPres)\r\n//       }\r\n//     }\r\n//     // detect if user has left from all tabs/devices, or is still present\r\n//     let onLeave = (id, current, leftPres) => {\r\n//       if(current.metas.length === 0){\r\n//         console.log(\"user has left from all devices\", leftPres)\r\n//       } else {\r\n//         console.log(\"user left from a device\", leftPres)\r\n//       }\r\n//     }\r\n//     let presences = {} // client's initial empty presence state\r\n//     // receive initial presence data from server, sent after join\r\n//     myChannel.on(\"presences\", state => {\r\n//       presences = Presence.syncState(presences, state, onJoin, onLeave)\r\n//       displayUsers(Presence.list(presences))\r\n//     })\r\n//     // receive \"presence_diff\" from server, containing join/leave events\r\n//     myChannel.on(\"presence_diff\", diff => {\r\n//       presences = Presence.syncDiff(presences, diff, onJoin, onLeave)\r\n//       this.setState({users: Presence.list(room.presences, listBy)})\r\n//     })\r\n//\r\nvar VSN = \"1.0.0\";\r\nvar SOCKET_STATES = { connecting: 0, open: 1, closing: 2, closed: 3 };\r\nvar DEFAULT_TIMEOUT = 10000;\r\nvar CHANNEL_STATES = {\r\n  closed: \"closed\",\r\n  errored: \"errored\",\r\n  joined: \"joined\",\r\n  joining: \"joining\",\r\n  leaving: \"leaving\"\r\n};\r\nvar CHANNEL_EVENTS = {\r\n  close: \"phx_close\",\r\n  error: \"phx_error\",\r\n  join: \"phx_join\",\r\n  reply: \"phx_reply\",\r\n  leave: \"phx_leave\"\r\n};\r\nvar TRANSPORTS = {\r\n  longpoll: \"longpoll\",\r\n  websocket: \"websocket\"\r\n};\r\n\r\nvar Push = function () {\r\n\r\n  // Initializes the Push\r\n  //\r\n  // channel - The Channel\r\n  // event - The event, for example `\"phx_join\"`\r\n  // payload - The payload, for example `{user_id: 123}`\r\n  // timeout - The push timeout in milliseconds\r\n  //\r\n\r\n  function Push(channel, event, payload, timeout) {\r\n    _classCallCheck(this, Push);\r\n\r\n    this.channel = channel;\r\n    this.event = event;\r\n    this.payload = payload || {};\r\n    this.receivedResp = null;\r\n    this.timeout = timeout;\r\n    this.timeoutTimer = null;\r\n    this.recHooks = [];\r\n    this.sent = false;\r\n  }\r\n\r\n  _createClass(Push, [{\r\n    key: \"resend\",\r\n    value: function resend(timeout) {\r\n      this.timeout = timeout;\r\n      this.cancelRefEvent();\r\n      this.ref = null;\r\n      this.refEvent = null;\r\n      this.receivedResp = null;\r\n      this.sent = false;\r\n      this.send();\r\n    }\r\n  }, {\r\n    key: \"send\",\r\n    value: function send() {\r\n      if (this.hasReceived(\"timeout\")) {\r\n        return;\r\n      }\r\n      this.startTimeout();\r\n      this.sent = true;\r\n      this.channel.socket.push({\r\n        topic: this.channel.topic,\r\n        event: this.event,\r\n        payload: this.payload,\r\n        ref: this.ref\r\n      });\r\n    }\r\n  }, {\r\n    key: \"receive\",\r\n    value: function receive(status, callback) {\r\n      if (this.hasReceived(status)) {\r\n        callback(this.receivedResp.response);\r\n      }\r\n\r\n      this.recHooks.push({ status: status, callback: callback });\r\n      return this;\r\n    }\r\n\r\n    // private\r\n\r\n  }, {\r\n    key: \"matchReceive\",\r\n    value: function matchReceive(_ref) {\r\n      var status = _ref.status;\r\n      var response = _ref.response;\r\n      var ref = _ref.ref;\r\n\r\n      this.recHooks.filter(function (h) {\r\n        return h.status === status;\r\n      }).forEach(function (h) {\r\n        return h.callback(response);\r\n      });\r\n    }\r\n  }, {\r\n    key: \"cancelRefEvent\",\r\n    value: function cancelRefEvent() {\r\n      if (!this.refEvent) {\r\n        return;\r\n      }\r\n      this.channel.off(this.refEvent);\r\n    }\r\n  }, {\r\n    key: \"cancelTimeout\",\r\n    value: function cancelTimeout() {\r\n      clearTimeout(this.timeoutTimer);\r\n      this.timeoutTimer = null;\r\n    }\r\n  }, {\r\n    key: \"startTimeout\",\r\n    value: function startTimeout() {\r\n      var _this = this;\r\n\r\n      if (this.timeoutTimer) {\r\n        return;\r\n      }\r\n      this.ref = this.channel.socket.makeRef();\r\n      this.refEvent = this.channel.replyEventName(this.ref);\r\n\r\n      this.channel.on(this.refEvent, function (payload) {\r\n        _this.cancelRefEvent();\r\n        _this.cancelTimeout();\r\n        _this.receivedResp = payload;\r\n        _this.matchReceive(payload);\r\n      });\r\n\r\n      this.timeoutTimer = setTimeout(function () {\r\n        _this.trigger(\"timeout\", {});\r\n      }, this.timeout);\r\n    }\r\n  }, {\r\n    key: \"hasReceived\",\r\n    value: function hasReceived(status) {\r\n      return this.receivedResp && this.receivedResp.status === status;\r\n    }\r\n  }, {\r\n    key: \"trigger\",\r\n    value: function trigger(status, response) {\r\n      this.channel.trigger(this.refEvent, { status: status, response: response });\r\n    }\r\n  }]);\r\n\r\n  return Push;\r\n}();\r\n\r\nvar Channel = exports.Channel = function () {\r\n  function Channel(topic, params, socket) {\r\n    var _this2 = this;\r\n\r\n    _classCallCheck(this, Channel);\r\n\r\n    this.state = CHANNEL_STATES.closed;\r\n    this.topic = topic;\r\n    this.params = params || {};\r\n    this.socket = socket;\r\n    this.bindings = [];\r\n    this.timeout = this.socket.timeout;\r\n    this.joinedOnce = false;\r\n    this.joinPush = new Push(this, CHANNEL_EVENTS.join, this.params, this.timeout);\r\n    this.pushBuffer = [];\r\n    this.rejoinTimer = new Timer(function () {\r\n      return _this2.rejoinUntilConnected();\r\n    }, this.socket.reconnectAfterMs);\r\n    this.joinPush.receive(\"ok\", function () {\r\n      _this2.state = CHANNEL_STATES.joined;\r\n      _this2.rejoinTimer.reset();\r\n      _this2.pushBuffer.forEach(function (pushEvent) {\r\n        return pushEvent.send();\r\n      });\r\n      _this2.pushBuffer = [];\r\n    });\r\n    this.onClose(function () {\r\n      _this2.rejoinTimer.reset();\r\n      _this2.socket.log(\"channel\", \"close \" + _this2.topic + \" \" + _this2.joinRef());\r\n      _this2.state = CHANNEL_STATES.closed;\r\n      _this2.socket.remove(_this2);\r\n    });\r\n    this.onError(function (reason) {\r\n      if (_this2.isLeaving() || _this2.isClosed()) {\r\n        return;\r\n      }\r\n      _this2.socket.log(\"channel\", \"error \" + _this2.topic, reason);\r\n      _this2.state = CHANNEL_STATES.errored;\r\n      _this2.rejoinTimer.scheduleTimeout();\r\n    });\r\n    this.joinPush.receive(\"timeout\", function () {\r\n      if (!_this2.isJoining()) {\r\n        return;\r\n      }\r\n      _this2.socket.log(\"channel\", \"timeout \" + _this2.topic, _this2.joinPush.timeout);\r\n      _this2.state = CHANNEL_STATES.errored;\r\n      _this2.rejoinTimer.scheduleTimeout();\r\n    });\r\n    this.on(CHANNEL_EVENTS.reply, function (payload, ref) {\r\n      _this2.trigger(_this2.replyEventName(ref), payload);\r\n    });\r\n  }\r\n\r\n  _createClass(Channel, [{\r\n    key: \"rejoinUntilConnected\",\r\n    value: function rejoinUntilConnected() {\r\n      this.rejoinTimer.scheduleTimeout();\r\n      if (this.socket.isConnected()) {\r\n        this.rejoin();\r\n      }\r\n    }\r\n  }, {\r\n    key: \"join\",\r\n    value: function join() {\r\n      var timeout = arguments.length <= 0 || arguments[0] === undefined ? this.timeout : arguments[0];\r\n\r\n      if (this.joinedOnce) {\r\n        throw \"tried to join multiple times. 'join' can only be called a single time per channel instance\";\r\n      } else {\r\n        this.joinedOnce = true;\r\n        this.rejoin(timeout);\r\n        return this.joinPush;\r\n      }\r\n    }\r\n  }, {\r\n    key: \"onClose\",\r\n    value: function onClose(callback) {\r\n      this.on(CHANNEL_EVENTS.close, callback);\r\n    }\r\n  }, {\r\n    key: \"onError\",\r\n    value: function onError(callback) {\r\n      this.on(CHANNEL_EVENTS.error, function (reason) {\r\n        return callback(reason);\r\n      });\r\n    }\r\n  }, {\r\n    key: \"on\",\r\n    value: function on(event, callback) {\r\n      this.bindings.push({ event: event, callback: callback });\r\n    }\r\n  }, {\r\n    key: \"off\",\r\n    value: function off(event) {\r\n      this.bindings = this.bindings.filter(function (bind) {\r\n        return bind.event !== event;\r\n      });\r\n    }\r\n  }, {\r\n    key: \"canPush\",\r\n    value: function canPush() {\r\n      return this.socket.isConnected() && this.isJoined();\r\n    }\r\n  }, {\r\n    key: \"push\",\r\n    value: function push(event, payload) {\r\n      var timeout = arguments.length <= 2 || arguments[2] === undefined ? this.timeout : arguments[2];\r\n\r\n      if (!this.joinedOnce) {\r\n        throw \"tried to push '\" + event + \"' to '\" + this.topic + \"' before joining. Use channel.join() before pushing events\";\r\n      }\r\n      var pushEvent = new Push(this, event, payload, timeout);\r\n      if (this.canPush()) {\r\n        pushEvent.send();\r\n      } else {\r\n        pushEvent.startTimeout();\r\n        this.pushBuffer.push(pushEvent);\r\n      }\r\n\r\n      return pushEvent;\r\n    }\r\n\r\n    // Leaves the channel\r\n    //\r\n    // Unsubscribes from server events, and\r\n    // instructs channel to terminate on server\r\n    //\r\n    // Triggers onClose() hooks\r\n    //\r\n    // To receive leave acknowledgements, use the a `receive`\r\n    // hook to bind to the server ack, ie:\r\n    //\r\n    //     channel.leave().receive(\"ok\", () => alert(\"left!\") )\r\n    //\r\n\r\n  }, {\r\n    key: \"leave\",\r\n    value: function leave() {\r\n      var _this3 = this;\r\n\r\n      var timeout = arguments.length <= 0 || arguments[0] === undefined ? this.timeout : arguments[0];\r\n\r\n      this.state = CHANNEL_STATES.leaving;\r\n      var onClose = function onClose() {\r\n        _this3.socket.log(\"channel\", \"leave \" + _this3.topic);\r\n        _this3.trigger(CHANNEL_EVENTS.close, \"leave\", _this3.joinRef());\r\n      };\r\n      var leavePush = new Push(this, CHANNEL_EVENTS.leave, {}, timeout);\r\n      leavePush.receive(\"ok\", function () {\r\n        return onClose();\r\n      }).receive(\"timeout\", function () {\r\n        return onClose();\r\n      });\r\n      leavePush.send();\r\n      if (!this.canPush()) {\r\n        leavePush.trigger(\"ok\", {});\r\n      }\r\n\r\n      return leavePush;\r\n    }\r\n\r\n    // Overridable message hook\r\n    //\r\n    // Receives all events for specialized message handling\r\n    // before dispatching to the channel callbacks.\r\n    //\r\n    // Must return the payload, modified or unmodified\r\n\r\n  }, {\r\n    key: \"onMessage\",\r\n    value: function onMessage(event, payload, ref) {\r\n      return payload;\r\n    }\r\n\r\n    // private\r\n\r\n  }, {\r\n    key: \"isMember\",\r\n    value: function isMember(topic) {\r\n      return this.topic === topic;\r\n    }\r\n  }, {\r\n    key: \"joinRef\",\r\n    value: function joinRef() {\r\n      return this.joinPush.ref;\r\n    }\r\n  }, {\r\n    key: \"sendJoin\",\r\n    value: function sendJoin(timeout) {\r\n      this.state = CHANNEL_STATES.joining;\r\n      this.joinPush.resend(timeout);\r\n    }\r\n  }, {\r\n    key: \"rejoin\",\r\n    value: function rejoin() {\r\n      var timeout = arguments.length <= 0 || arguments[0] === undefined ? this.timeout : arguments[0];\r\n      if (this.isLeaving()) {\r\n        return;\r\n      }\r\n      this.sendJoin(timeout);\r\n    }\r\n  }, {\r\n    key: \"trigger\",\r\n    value: function trigger(event, payload, ref) {\r\n      var close = CHANNEL_EVENTS.close;\r\n      var error = CHANNEL_EVENTS.error;\r\n      var leave = CHANNEL_EVENTS.leave;\r\n      var join = CHANNEL_EVENTS.join;\r\n\r\n      if (ref && [close, error, leave, join].indexOf(event) >= 0 && ref !== this.joinRef()) {\r\n        return;\r\n      }\r\n      var handledPayload = this.onMessage(event, payload, ref);\r\n      if (payload && !handledPayload) {\r\n        throw \"channel onMessage callbacks must return the payload, modified or unmodified\";\r\n      }\r\n\r\n      this.bindings.filter(function (bind) {\r\n        return bind.event === event;\r\n      }).map(function (bind) {\r\n        return bind.callback(handledPayload, ref);\r\n      });\r\n    }\r\n  }, {\r\n    key: \"replyEventName\",\r\n    value: function replyEventName(ref) {\r\n      return \"chan_reply_\" + ref;\r\n    }\r\n  }, {\r\n    key: \"isClosed\",\r\n    value: function isClosed() {\r\n      return this.state === CHANNEL_STATES.closed;\r\n    }\r\n  }, {\r\n    key: \"isErrored\",\r\n    value: function isErrored() {\r\n      return this.state === CHANNEL_STATES.errored;\r\n    }\r\n  }, {\r\n    key: \"isJoined\",\r\n    value: function isJoined() {\r\n      return this.state === CHANNEL_STATES.joined;\r\n    }\r\n  }, {\r\n    key: \"isJoining\",\r\n    value: function isJoining() {\r\n      return this.state === CHANNEL_STATES.joining;\r\n    }\r\n  }, {\r\n    key: \"isLeaving\",\r\n    value: function isLeaving() {\r\n      return this.state === CHANNEL_STATES.leaving;\r\n    }\r\n  }]);\r\n\r\n  return Channel;\r\n}();\r\n\r\nvar Socket = exports.Socket = function () {\r\n\r\n  // Initializes the Socket\r\n  //\r\n  // endPoint - The string WebSocket endpoint, ie, \"ws://example.com/ws\",\r\n  //                                               \"wss://example.com\"\r\n  //                                               \"/ws\" (inherited host & protocol)\r\n  // opts - Optional configuration\r\n  //   transport - The Websocket Transport, for example WebSocket or Phoenix.LongPoll.\r\n  //               Defaults to WebSocket with automatic LongPoll fallback.\r\n  //   timeout - The default timeout in milliseconds to trigger push timeouts.\r\n  //             Defaults `DEFAULT_TIMEOUT`\r\n  //   heartbeatIntervalMs - The millisec interval to send a heartbeat message\r\n  //   reconnectAfterMs - The optional function that returns the millsec\r\n  //                      reconnect interval. Defaults to stepped backoff of:\r\n  //\r\n  //     function(tries){\r\n  //       return [1000, 5000, 10000][tries - 1] || 10000\r\n  //     }\r\n  //\r\n  //   logger - The optional function for specialized logging, ie:\r\n  //     `logger: (kind, msg, data) => { console.log(`${kind}: ${msg}`, data) }\r\n  //\r\n  //   longpollerTimeout - The maximum timeout of a long poll AJAX request.\r\n  //                        Defaults to 20s (double the server long poll timer).\r\n  //\r\n  //   params - The optional params to pass when connecting\r\n  //\r\n  // For IE8 support use an ES5-shim (https://github.com/es-shims/es5-shim)\r\n  //\r\n\r\n  function Socket(endPoint) {\r\n    var _this4 = this;\r\n\r\n    var opts = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\r\n\r\n    _classCallCheck(this, Socket);\r\n\r\n    this.stateChangeCallbacks = { open: [], close: [], error: [], message: [] };\r\n    this.channels = [];\r\n    this.sendBuffer = [];\r\n    this.ref = 0;\r\n    this.timeout = opts.timeout || DEFAULT_TIMEOUT;\r\n    this.transport = opts.transport || window.WebSocket || LongPoll;\r\n    this.heartbeatIntervalMs = opts.heartbeatIntervalMs || 30000;\r\n    this.reconnectAfterMs = opts.reconnectAfterMs || function (tries) {\r\n      return [1000, 2000, 5000, 10000][tries - 1] || 10000;\r\n    };\r\n    this.logger = opts.logger || function () {}; // noop\r\n    this.longpollerTimeout = opts.longpollerTimeout || 20000;\r\n    this.params = opts.params || {};\r\n    this.endPoint = endPoint + \"/\" + TRANSPORTS.websocket;\r\n    this.reconnectTimer = new Timer(function () {\r\n      _this4.disconnect(function () {\r\n        return _this4.connect();\r\n      });\r\n    }, this.reconnectAfterMs);\r\n  }\r\n\r\n  _createClass(Socket, [{\r\n    key: \"protocol\",\r\n    value: function protocol() {\r\n      return location.protocol.match(/^https/) ? \"wss\" : \"ws\";\r\n    }\r\n  }, {\r\n    key: \"endPointURL\",\r\n    value: function endPointURL() {\r\n      var uri = Ajax.appendParams(Ajax.appendParams(this.endPoint, this.params), { vsn: VSN });\r\n      if (uri.charAt(0) !== \"/\") {\r\n        return uri;\r\n      }\r\n      if (uri.charAt(1) === \"/\") {\r\n        return this.protocol() + \":\" + uri;\r\n      }\r\n\r\n      return this.protocol() + \"://\" + location.host + uri;\r\n    }\r\n  }, {\r\n    key: \"disconnect\",\r\n    value: function disconnect(callback, code, reason) {\r\n      if (this.conn) {\r\n        this.conn.onclose = function () {}; // noop\r\n        if (code) {\r\n          this.conn.close(code, reason || \"\");\r\n        } else {\r\n          this.conn.close();\r\n        }\r\n        this.conn = null;\r\n      }\r\n      callback && callback();\r\n    }\r\n\r\n    // params - The params to send when connecting, for example `{user_id: userToken}`\r\n\r\n  }, {\r\n    key: \"connect\",\r\n    value: function connect(params) {\r\n      var _this5 = this;\r\n\r\n      if (params) {\r\n        console && console.log(\"passing params to connect is deprecated. Instead pass :params to the Socket constructor\");\r\n        this.params = params;\r\n      }\r\n      if (this.conn) {\r\n        return;\r\n      }\r\n\r\n      this.conn = new this.transport(this.endPointURL());\r\n      this.conn.timeout = this.longpollerTimeout;\r\n      this.conn.onopen = function () {\r\n        return _this5.onConnOpen();\r\n      };\r\n      this.conn.onerror = function (error) {\r\n        return _this5.onConnError(error);\r\n      };\r\n      this.conn.onmessage = function (event) {\r\n        return _this5.onConnMessage(event);\r\n      };\r\n      this.conn.onclose = function (event) {\r\n        return _this5.onConnClose(event);\r\n      };\r\n    }\r\n\r\n    // Logs the message. Override `this.logger` for specialized logging. noops by default\r\n\r\n  }, {\r\n    key: \"log\",\r\n    value: function log(kind, msg, data) {\r\n      this.logger(kind, msg, data);\r\n    }\r\n\r\n    // Registers callbacks for connection state change events\r\n    //\r\n    // Examples\r\n    //\r\n    //    socket.onError(function(error){ alert(\"An error occurred\") })\r\n    //\r\n\r\n  }, {\r\n    key: \"onOpen\",\r\n    value: function onOpen(callback) {\r\n      this.stateChangeCallbacks.open.push(callback);\r\n    }\r\n  }, {\r\n    key: \"onClose\",\r\n    value: function onClose(callback) {\r\n      this.stateChangeCallbacks.close.push(callback);\r\n    }\r\n  }, {\r\n    key: \"onError\",\r\n    value: function onError(callback) {\r\n      this.stateChangeCallbacks.error.push(callback);\r\n    }\r\n  }, {\r\n    key: \"onMessage\",\r\n    value: function onMessage(callback) {\r\n      this.stateChangeCallbacks.message.push(callback);\r\n    }\r\n  }, {\r\n    key: \"onConnOpen\",\r\n    value: function onConnOpen() {\r\n      var _this6 = this;\r\n\r\n      this.log(\"transport\", \"connected to \" + this.endPointURL(), this.transport.prototype);\r\n      this.flushSendBuffer();\r\n      this.reconnectTimer.reset();\r\n      if (!this.conn.skipHeartbeat) {\r\n        clearInterval(this.heartbeatTimer);\r\n        this.heartbeatTimer = setInterval(function () {\r\n          return _this6.sendHeartbeat();\r\n        }, this.heartbeatIntervalMs);\r\n      }\r\n      this.stateChangeCallbacks.open.forEach(function (callback) {\r\n        return callback();\r\n      });\r\n    }\r\n  }, {\r\n    key: \"onConnClose\",\r\n    value: function onConnClose(event) {\r\n      this.log(\"transport\", \"close\", event);\r\n      this.triggerChanError();\r\n      clearInterval(this.heartbeatTimer);\r\n      this.reconnectTimer.scheduleTimeout();\r\n      this.stateChangeCallbacks.close.forEach(function (callback) {\r\n        return callback(event);\r\n      });\r\n    }\r\n  }, {\r\n    key: \"onConnError\",\r\n    value: function onConnError(error) {\r\n      this.log(\"transport\", error);\r\n      this.triggerChanError();\r\n      this.stateChangeCallbacks.error.forEach(function (callback) {\r\n        return callback(error);\r\n      });\r\n    }\r\n  }, {\r\n    key: \"triggerChanError\",\r\n    value: function triggerChanError() {\r\n      this.channels.forEach(function (channel) {\r\n        return channel.trigger(CHANNEL_EVENTS.error);\r\n      });\r\n    }\r\n  }, {\r\n    key: \"connectionState\",\r\n    value: function connectionState() {\r\n      switch (this.conn && this.conn.readyState) {\r\n        case SOCKET_STATES.connecting:\r\n          return \"connecting\";\r\n        case SOCKET_STATES.open:\r\n          return \"open\";\r\n        case SOCKET_STATES.closing:\r\n          return \"closing\";\r\n        default:\r\n          return \"closed\";\r\n      }\r\n    }\r\n  }, {\r\n    key: \"isConnected\",\r\n    value: function isConnected() {\r\n      return this.connectionState() === \"open\";\r\n    }\r\n  }, {\r\n    key: \"remove\",\r\n    value: function remove(channel) {\r\n      this.channels = this.channels.filter(function (c) {\r\n        return c.joinRef() !== channel.joinRef();\r\n      });\r\n    }\r\n  }, {\r\n    key: \"channel\",\r\n    value: function channel(topic) {\r\n      var chanParams = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\r\n\r\n      var chan = new Channel(topic, chanParams, this);\r\n      this.channels.push(chan);\r\n      return chan;\r\n    }\r\n  }, {\r\n    key: \"push\",\r\n    value: function push(data) {\r\n      var _this7 = this;\r\n\r\n      var topic = data.topic;\r\n      var event = data.event;\r\n      var payload = data.payload;\r\n      var ref = data.ref;\r\n\r\n      var callback = function callback() {\r\n        return _this7.conn.send(JSON.stringify(data));\r\n      };\r\n      this.log(\"push\", topic + \" \" + event + \" (\" + ref + \")\", payload);\r\n      if (this.isConnected()) {\r\n        callback();\r\n      } else {\r\n        this.sendBuffer.push(callback);\r\n      }\r\n    }\r\n\r\n    // Return the next message ref, accounting for overflows\r\n\r\n  }, {\r\n    key: \"makeRef\",\r\n    value: function makeRef() {\r\n      var newRef = this.ref + 1;\r\n      if (newRef === this.ref) {\r\n        this.ref = 0;\r\n      } else {\r\n        this.ref = newRef;\r\n      }\r\n\r\n      return this.ref.toString();\r\n    }\r\n  }, {\r\n    key: \"sendHeartbeat\",\r\n    value: function sendHeartbeat() {\r\n      if (!this.isConnected()) {\r\n        return;\r\n      }\r\n      this.push({ topic: \"phoenix\", event: \"heartbeat\", payload: {}, ref: this.makeRef() });\r\n    }\r\n  }, {\r\n    key: \"flushSendBuffer\",\r\n    value: function flushSendBuffer() {\r\n      if (this.isConnected() && this.sendBuffer.length > 0) {\r\n        this.sendBuffer.forEach(function (callback) {\r\n          return callback();\r\n        });\r\n        this.sendBuffer = [];\r\n      }\r\n    }\r\n  }, {\r\n    key: \"onConnMessage\",\r\n    value: function onConnMessage(rawMessage) {\r\n      var msg = JSON.parse(rawMessage.data);\r\n      var topic = msg.topic;\r\n      var event = msg.event;\r\n      var payload = msg.payload;\r\n      var ref = msg.ref;\r\n\r\n      this.log(\"receive\", (payload.status || \"\") + \" \" + topic + \" \" + event + \" \" + (ref && \"(\" + ref + \")\" || \"\"), payload);\r\n      this.channels.filter(function (channel) {\r\n        return channel.isMember(topic);\r\n      }).forEach(function (channel) {\r\n        return channel.trigger(event, payload, ref);\r\n      });\r\n      this.stateChangeCallbacks.message.forEach(function (callback) {\r\n        return callback(msg);\r\n      });\r\n    }\r\n  }]);\r\n\r\n  return Socket;\r\n}();\r\n\r\nvar LongPoll = exports.LongPoll = function () {\r\n  function LongPoll(endPoint) {\r\n    _classCallCheck(this, LongPoll);\r\n\r\n    this.endPoint = null;\r\n    this.token = null;\r\n    this.skipHeartbeat = true;\r\n    this.onopen = function () {}; // noop\r\n    this.onerror = function () {}; // noop\r\n    this.onmessage = function () {}; // noop\r\n    this.onclose = function () {}; // noop\r\n    this.pollEndpoint = this.normalizeEndpoint(endPoint);\r\n    this.readyState = SOCKET_STATES.connecting;\r\n\r\n    this.poll();\r\n  }\r\n\r\n  _createClass(LongPoll, [{\r\n    key: \"normalizeEndpoint\",\r\n    value: function normalizeEndpoint(endPoint) {\r\n      return endPoint.replace(\"ws://\", \"http://\").replace(\"wss://\", \"https://\").replace(new RegExp(\"(.*)\\/\" + TRANSPORTS.websocket), \"$1/\" + TRANSPORTS.longpoll);\r\n    }\r\n  }, {\r\n    key: \"endpointURL\",\r\n    value: function endpointURL() {\r\n      return Ajax.appendParams(this.pollEndpoint, { token: this.token });\r\n    }\r\n  }, {\r\n    key: \"closeAndRetry\",\r\n    value: function closeAndRetry() {\r\n      this.close();\r\n      this.readyState = SOCKET_STATES.connecting;\r\n    }\r\n  }, {\r\n    key: \"ontimeout\",\r\n    value: function ontimeout() {\r\n      this.onerror(\"timeout\");\r\n      this.closeAndRetry();\r\n    }\r\n  }, {\r\n    key: \"poll\",\r\n    value: function poll() {\r\n      var _this8 = this;\r\n\r\n      if (!(this.readyState === SOCKET_STATES.open || this.readyState === SOCKET_STATES.connecting)) {\r\n        return;\r\n      }\r\n\r\n      Ajax.request(\"GET\", this.endpointURL(), \"application/json\", null, this.timeout, this.ontimeout.bind(this), function (resp) {\r\n        if (resp) {\r\n          var status = resp.status;\r\n          var token = resp.token;\r\n          var messages = resp.messages;\r\n\r\n          _this8.token = token;\r\n        } else {\r\n          var status = 0;\r\n        }\r\n\r\n        switch (status) {\r\n          case 200:\r\n            messages.forEach(function (msg) {\r\n              return _this8.onmessage({ data: JSON.stringify(msg) });\r\n            });\r\n            _this8.poll();\r\n            break;\r\n          case 204:\r\n            _this8.poll();\r\n            break;\r\n          case 410:\r\n            _this8.readyState = SOCKET_STATES.open;\r\n            _this8.onopen();\r\n            _this8.poll();\r\n            break;\r\n          case 0:\r\n          case 500:\r\n            _this8.onerror();\r\n            _this8.closeAndRetry();\r\n            break;\r\n          default:\r\n            throw \"unhandled poll status \" + status;\r\n        }\r\n      });\r\n    }\r\n  }, {\r\n    key: \"send\",\r\n    value: function send(body) {\r\n      var _this9 = this;\r\n\r\n      Ajax.request(\"POST\", this.endpointURL(), \"application/json\", body, this.timeout, this.onerror.bind(this, \"timeout\"), function (resp) {\r\n        if (!resp || resp.status !== 200) {\r\n          _this9.onerror(status);\r\n          _this9.closeAndRetry();\r\n        }\r\n      });\r\n    }\r\n  }, {\r\n    key: \"close\",\r\n    value: function close(code, reason) {\r\n      this.readyState = SOCKET_STATES.closed;\r\n      this.onclose();\r\n    }\r\n  }]);\r\n\r\n  return LongPoll;\r\n}();\r\n\r\nvar Ajax = exports.Ajax = function () {\r\n  function Ajax() {\r\n    _classCallCheck(this, Ajax);\r\n  }\r\n\r\n  _createClass(Ajax, null, [{\r\n    key: \"request\",\r\n    value: function request(method, endPoint, accept, body, timeout, ontimeout, callback) {\r\n      if (window.XDomainRequest) {\r\n        var req = new XDomainRequest(); // IE8, IE9\r\n        this.xdomainRequest(req, method, endPoint, body, timeout, ontimeout, callback);\r\n      } else {\r\n        var req = window.XMLHttpRequest ? new XMLHttpRequest() : // IE7+, Firefox, Chrome, Opera, Safari\r\n        new ActiveXObject(\"Microsoft.XMLHTTP\"); // IE6, IE5\r\n        this.xhrRequest(req, method, endPoint, accept, body, timeout, ontimeout, callback);\r\n      }\r\n    }\r\n  }, {\r\n    key: \"xdomainRequest\",\r\n    value: function xdomainRequest(req, method, endPoint, body, timeout, ontimeout, callback) {\r\n      var _this10 = this;\r\n\r\n      req.timeout = timeout;\r\n      req.open(method, endPoint);\r\n      req.onload = function () {\r\n        var response = _this10.parseJSON(req.responseText);\r\n        callback && callback(response);\r\n      };\r\n      if (ontimeout) {\r\n        req.ontimeout = ontimeout;\r\n      }\r\n\r\n      // Work around bug in IE9 that requires an attached onprogress handler\r\n      req.onprogress = function () {};\r\n\r\n      req.send(body);\r\n    }\r\n  }, {\r\n    key: \"xhrRequest\",\r\n    value: function xhrRequest(req, method, endPoint, accept, body, timeout, ontimeout, callback) {\r\n      var _this11 = this;\r\n\r\n      req.timeout = timeout;\r\n      req.open(method, endPoint, true);\r\n      req.setRequestHeader(\"Content-Type\", accept);\r\n      req.onerror = function () {\r\n        callback && callback(null);\r\n      };\r\n      req.onreadystatechange = function () {\r\n        if (req.readyState === _this11.states.complete && callback) {\r\n          var response = _this11.parseJSON(req.responseText);\r\n          callback(response);\r\n        }\r\n      };\r\n      if (ontimeout) {\r\n        req.ontimeout = ontimeout;\r\n      }\r\n\r\n      req.send(body);\r\n    }\r\n  }, {\r\n    key: \"parseJSON\",\r\n    value: function parseJSON(resp) {\r\n      return resp && resp !== \"\" ? JSON.parse(resp) : null;\r\n    }\r\n  }, {\r\n    key: \"serialize\",\r\n    value: function serialize(obj, parentKey) {\r\n      var queryStr = [];\r\n      for (var key in obj) {\r\n        if (!obj.hasOwnProperty(key)) {\r\n          continue;\r\n        }\r\n        var paramKey = parentKey ? parentKey + \"[\" + key + \"]\" : key;\r\n        var paramVal = obj[key];\r\n        if ((typeof paramVal === \"undefined\" ? \"undefined\" : _typeof(paramVal)) === \"object\") {\r\n          queryStr.push(this.serialize(paramVal, paramKey));\r\n        } else {\r\n          queryStr.push(encodeURIComponent(paramKey) + \"=\" + encodeURIComponent(paramVal));\r\n        }\r\n      }\r\n      return queryStr.join(\"&\");\r\n    }\r\n  }, {\r\n    key: \"appendParams\",\r\n    value: function appendParams(url, params) {\r\n      if (Object.keys(params).length === 0) {\r\n        return url;\r\n      }\r\n\r\n      var prefix = url.match(/\\?/) ? \"&\" : \"?\";\r\n      return \"\" + url + prefix + this.serialize(params);\r\n    }\r\n  }]);\r\n\r\n  return Ajax;\r\n}();\r\n\r\nAjax.states = { complete: 4 };\r\n\r\nvar Presence = exports.Presence = {\r\n  syncState: function syncState(currentState, newState, onJoin, onLeave) {\r\n    var _this12 = this;\r\n\r\n    var state = this.clone(currentState);\r\n    var joins = {};\r\n    var leaves = {};\r\n\r\n    this.map(state, function (key, presence) {\r\n      if (!newState[key]) {\r\n        leaves[key] = presence;\r\n      }\r\n    });\r\n    this.map(newState, function (key, newPresence) {\r\n      var currentPresence = state[key];\r\n      if (currentPresence) {\r\n        (function () {\r\n          var newRefs = newPresence.metas.map(function (m) {\r\n            return m.phx_ref;\r\n          });\r\n          var curRefs = currentPresence.metas.map(function (m) {\r\n            return m.phx_ref;\r\n          });\r\n          var joinedMetas = newPresence.metas.filter(function (m) {\r\n            return curRefs.indexOf(m.phx_ref) < 0;\r\n          });\r\n          var leftMetas = currentPresence.metas.filter(function (m) {\r\n            return newRefs.indexOf(m.phx_ref) < 0;\r\n          });\r\n          if (joinedMetas.length > 0) {\r\n            joins[key] = newPresence;\r\n            joins[key].metas = joinedMetas;\r\n          }\r\n          if (leftMetas.length > 0) {\r\n            leaves[key] = _this12.clone(currentPresence);\r\n            leaves[key].metas = leftMetas;\r\n          }\r\n        })();\r\n      } else {\r\n        joins[key] = newPresence;\r\n      }\r\n    });\r\n    return this.syncDiff(state, { joins: joins, leaves: leaves }, onJoin, onLeave);\r\n  },\r\n  syncDiff: function syncDiff(currentState, _ref2, onJoin, onLeave) {\r\n    var joins = _ref2.joins;\r\n    var leaves = _ref2.leaves;\r\n\r\n    var state = this.clone(currentState);\r\n    if (!onJoin) {\r\n      onJoin = function onJoin() {};\r\n    }\r\n    if (!onLeave) {\r\n      onLeave = function onLeave() {};\r\n    }\r\n\r\n    this.map(joins, function (key, newPresence) {\r\n      var currentPresence = state[key];\r\n      state[key] = newPresence;\r\n      if (currentPresence) {\r\n        var _state$key$metas;\r\n\r\n        (_state$key$metas = state[key].metas).unshift.apply(_state$key$metas, _toConsumableArray(currentPresence.metas));\r\n      }\r\n      onJoin(key, currentPresence, newPresence);\r\n    });\r\n    this.map(leaves, function (key, leftPresence) {\r\n      var currentPresence = state[key];\r\n      if (!currentPresence) {\r\n        return;\r\n      }\r\n      var refsToRemove = leftPresence.metas.map(function (m) {\r\n        return m.phx_ref;\r\n      });\r\n      currentPresence.metas = currentPresence.metas.filter(function (p) {\r\n        return refsToRemove.indexOf(p.phx_ref) < 0;\r\n      });\r\n      onLeave(key, currentPresence, leftPresence);\r\n      if (currentPresence.metas.length === 0) {\r\n        delete state[key];\r\n      }\r\n    });\r\n    return state;\r\n  },\r\n  list: function list(presences, chooser) {\r\n    if (!chooser) {\r\n      chooser = function chooser(key, pres) {\r\n        return pres;\r\n      };\r\n    }\r\n\r\n    return this.map(presences, function (key, presence) {\r\n      return chooser(key, presence);\r\n    });\r\n  },\r\n\r\n  // private\r\n\r\n  map: function map(obj, func) {\r\n    return Object.getOwnPropertyNames(obj).map(function (key) {\r\n      return func(key, obj[key]);\r\n    });\r\n  },\r\n  clone: function clone(obj) {\r\n    return JSON.parse(JSON.stringify(obj));\r\n  }\r\n};\r\n\r\n// Creates a timer that accepts a `timerCalc` function to perform\r\n// calculated timeout retries, such as exponential backoff.\r\n//\r\n// ## Examples\r\n//\r\n//    let reconnectTimer = new Timer(() => this.connect(), function(tries){\r\n//      return [1000, 5000, 10000][tries - 1] || 10000\r\n//    })\r\n//    reconnectTimer.scheduleTimeout() // fires after 1000\r\n//    reconnectTimer.scheduleTimeout() // fires after 5000\r\n//    reconnectTimer.reset()\r\n//    reconnectTimer.scheduleTimeout() // fires after 1000\r\n//\r\n\r\nvar Timer = function () {\r\n  function Timer(callback, timerCalc) {\r\n    _classCallCheck(this, Timer);\r\n\r\n    this.callback = callback;\r\n    this.timerCalc = timerCalc;\r\n    this.timer = null;\r\n    this.tries = 0;\r\n  }\r\n\r\n  _createClass(Timer, [{\r\n    key: \"reset\",\r\n    value: function reset() {\r\n      this.tries = 0;\r\n      clearTimeout(this.timer);\r\n    }\r\n\r\n    // Cancels any previous scheduleTimeout and schedules callback\r\n\r\n  }, {\r\n    key: \"scheduleTimeout\",\r\n    value: function scheduleTimeout() {\r\n      var _this13 = this;\r\n\r\n      clearTimeout(this.timer);\r\n\r\n      this.timer = setTimeout(function () {\r\n        _this13.tries = _this13.tries + 1;\r\n        _this13.callback();\r\n      }, this.timerCalc(this.tries + 1));\r\n    }\r\n  }]);\r\n\r\n  return Timer;\r\n}();\r\n\r\n})(typeof(exports) === \"undefined\" ? window.Phoenix = window.Phoenix || {} : exports);\r\n\r\n","\"use strict\";\n\n(function() {\n  function buildHiddenInput(name, value) {\n    var input = document.createElement(\"input\");\n    input.type = \"hidden\";\n    input.name = name;\n    input.value = value;\n    return input;\n  }\n\n  function handleLinkClick(link) {\n    var message = link.getAttribute(\"data-confirm\");\n    if(message && !window.confirm(message)) {\n        return;\n    }\n\n    var to = link.getAttribute(\"data-to\"),\n        method = buildHiddenInput(\"_method\", link.getAttribute(\"data-method\")),\n        csrf = buildHiddenInput(\"_csrf_token\", link.getAttribute(\"data-csrf\")),\n        form = document.createElement(\"form\");\n\n    form.method = (link.getAttribute(\"data-method\") === \"get\") ? \"get\" : \"post\";\n    form.action = to;\n    form.style.display = \"hidden\";\n\n    form.appendChild(csrf);\n    form.appendChild(method);\n    document.body.appendChild(form);\n    form.submit();\n  }\n\n  window.addEventListener(\"click\", function(e) {\n    var element = e.target;\n\n    while (element && element.getAttribute) {\n      if(element.getAttribute(\"data-method\")) {\n        handleLinkClick(element);\n        e.preventDefault();\n        return false;\n      } else {\n        element = element.parentNode;\n      }\n    }\n  }, false);\n})();\n","let Player = {\r\n  player: null,\r\n\r\n  init(domId, playerId, onReady){\r\n    window.onYouTubeIframeAPIReady = () => {\r\n      this.onIframeReady(domId, playerId, onReady)\r\n    }\r\n    let youtubeScriptTag = document.createElement(\"script\")\r\n    youtubeScriptTag.src = \"//www.youtube.com/iframe_api\"\r\n    document.head.appendChild(youtubeScriptTag)\r\n  },\r\n\r\n  onIframeReady(domId, playerId, onReady){\r\n    this.player = new YT.Player(domId, {\r\n      height: \"360\",\r\n      width: \"420\",\r\n      videoId: playerId,\r\n      events: {\r\n        \"onReady\": (event => onReady(event) ),\r\n        \"onStateChange\": (event => this.onPlayerStateChange(event) )\r\n      }\r\n    })\r\n  },\r\n\r\n  onPlayerStateChange(event){ },\r\n  getCurrentTime(){ return Math.floor(this.player.getCurrentTime() * 1000) },\r\n  seekTo(millsec){ return this.player.seekTo(millsec / 1000) }\r\n}\r\nexport default Player","import {Socket} from \"./phoenix\"\n\nlet socket = new Socket(\"/socket\", {\n  params: {token: window.userToken},\n  logger: (kind, msg, data) => { console.log(`${kind}: ${msg}`, data) }\n})\n\nexport default socket","import Player from \"./player\"\r\n\r\nlet Video = {\r\n\r\n  init(socket, element){ if(!element){ return }\r\n    let playerId = element.getAttribute(\"data-player-id\")\r\n    let videoId = element.getAttribute(\"data-id\")\r\n\r\n    socket.connect()\r\n    Player.init(element.id, playerId, () => {\r\n      this.onReady(videoId, socket)\r\n    })\r\n  },\r\n\r\n  onReady(videoId, socket){\r\n    let msgContainer = document.getElementById(\"msg-container\")\r\n    let msgInput = document.getElementById(\"msg-input\")\r\n    let postButton = document.getElementById(\"msg-submit\")\r\n    let vidChannel = socket.channel(\"videos:\" + videoId)\r\n\r\n    postButton.addEventListener(\"click\", e => {\r\n      let payload = {body: msgInput.value, at: Player.getCurrentTime()}\r\n      vidChannel.push(\"new_annotation\", payload)\r\n                .receive(\"error\", e => console.log(e) )\r\n      msgInput.value = \"\"\r\n    })\r\n\r\n    msgContainer.addEventListener(\"click\", e => {\r\n      e.preventDefault()\r\n      let seconds = e.target.getAttribute(\"data-seek\") ||\r\n                    e.target.parentNode.getAttribute(\"data-seek\")\r\n      if(!seconds){ return }\r\n      Player.seekTo(seconds)\r\n    })\r\n\r\n    vidChannel.on(\"new_annotation\", (resp) => {\r\n      vidChannel.params.last_seen_id = resp.id\r\n      this.renderAnnotation(msgContainer, resp)\r\n    })\r\n\r\n    vidChannel.join()\r\n      .receive(\"ok\", resp => {\r\n        let ids = resp.annotations.map(ann => ann.id)\r\n        if(ids.length > 0){ vidChannel.params.last_seen_id = Math.max(...ids) }\r\n        this.scheduleMessages(msgContainer, resp.annotations)  \r\n      })\r\n      .receive(\"error\", reason => console.log(\"join failed\", reason) )\r\n  },\r\n\r\n  esc(str){\r\n    let div = document.createElement(\"div\")\r\n    div.appendChild(document.createTextNode(str))\r\n    return div.innerHTML\r\n  },\r\n\r\n  renderAnnotation(msgContainer, {user, body, at}){\r\n    let template = document.createElement(\"div\")\r\n    template.innerHTML = `\r\n    <a href=\"#\" data-seek=\"${this.esc(at)}\">\r\n      [${this.formatTime(at)}]\r\n      <b>${this.esc(user.username)}</b>: ${this.esc(body)}\r\n    </a>\r\n    `\r\n    msgContainer.appendChild(template)\r\n    msgContainer.scrollTop = msgContainer.scrollHeight\r\n  },\r\n\r\n  scheduleMessages(msgContainer, annotations){\r\n    setTimeout(() => {\r\n      let ctime = Player.getCurrentTime()\r\n      let remaining = this.renderAtTime(annotations, ctime, msgContainer)\r\n      this.scheduleMessages(msgContainer, remaining)\r\n    }, 1000)\r\n  },\r\n\r\n  renderAtTime(annotations, seconds, msgContainer){\r\n    return annotations.filter( ann => {\r\n      if(ann.at > seconds){\r\n        return true\r\n      } else {\r\n        this.renderAnnotation(msgContainer, ann)\r\n        return false\r\n      }\r\n    })\r\n  },\r\n\r\n  formatTime(at){\r\n    let date = new Date(null)\r\n    date.setSeconds(at / 1000)\r\n    return date.toISOString().substr(14, 5)\r\n  }\r\n}\r\nexport default Video"]}